# 次期アクションプラン提案

## 現在の達成状況

### ✅ 完了項目
1. **データ集約機能** - 90,000行→1,000行への削減実現
2. **フィルタリング機能** - Campaign/Performance双方で動作
3. **エラー防御層** - safe-data-access.tsによる根本対策
4. **F-CV列の追加** - 全テーブルに実装済み

### 🔍 現状の課題
1. **疲労度計算が不完全** - ユーザーからの指摘通り
2. **型定義の不統一** - anyが残存
3. **パフォーマンス** - 大量データ時の描画速度
4. **テストカバレッジ** - 自動テストが不足

## 提案する次期アクションプラン

### Option A: 疲労度計算の完成（推奨）
**目的**: コア機能の完成度を上げる

#### 実装内容
1. **ベースライン計算の実装**
   - 過去30日の平均値からベースラインを算出
   - CTR低下率、CPM上昇率の計算精度向上

2. **3つの疲労度指標の統合**
   ```typescript
   // 指標①: クリエイティブ疲労（CTR低下）
   const creativeFatigue = calculateCTRDegradation(current, baseline)
   
   // 指標②: 視聴者疲労（Frequency過多）
   const audienceFatigue = calculateFrequencyScore(frequency)
   
   // 指標③: アルゴリズム疲労（CPM上昇）
   const algorithmFatigue = calculateCPMIncrease(current, baseline)
   
   // 総合スコア（0-100）
   const totalScore = weightedAverage([
     creativeFatigue * 0.4,
     audienceFatigue * 0.3,
     algorithmFatigue * 0.3
   ])
   ```

3. **視覚的な改善**
   - スコアの色分け強化
   - トレンドグラフの追加
   - 警告通知の実装

**期待効果**: マーケターでなくても広告効果を判断可能に
**工数**: 4-6時間

---

### Option B: パフォーマンス最適化
**目的**: 大量データでも快適な操作性

#### 実装内容
1. **仮想スクロールの実装**
   - react-windowを使用したテーブル最適化
   - 1000件以上でも60fps維持

2. **データキャッシングの強化**
   - React.memoの適切な配置
   - useMemoの最適化

3. **遅延ローディング**
   - チャンク単位でのデータ取得
   - プログレッシブレンダリング

**期待効果**: 10万行でもスムーズな操作
**工数**: 3-4時間

---

### Option C: 型安全性の完全確保
**目的**: 将来的なバグを防ぐ

#### 実装内容
1. **TypeScript Strict Mode対応**
   ```json
   {
     "compilerOptions": {
       "strict": true,
       "noImplicitAny": true,
       "strictNullChecks": true
     }
   }
   ```

2. **全anyの排除**
   - 約50箇所のany型を具体的な型に置換
   - ジェネリクスの活用

3. **Runtime Type Validation**
   - zodによる実行時型チェック
   - APIレスポンスの検証

**期待効果**: 実行時エラー90%削減
**工数**: 6-8時間

---

### Option D: UI/UX改善
**目的**: ユーザビリティ向上

#### 実装内容
1. **ダッシュボードのカスタマイズ機能**
   - ウィジェット配置の自由化
   - 表示メトリクスの選択

2. **エクスポート機能**
   - CSV/Excel出力
   - PDFレポート生成

3. **比較ビュー**
   - 期間比較
   - A/Bテスト結果表示

**期待効果**: 業務効率20%向上
**工数**: 5-6時間

---

### Option E: テスト強化
**目的**: 品質保証

#### 実装内容
1. **ユニットテスト追加**
   - safe-data-access.test.ts
   - AdDataAggregator.test.ts
   - 疲労度計算ロジックのテスト

2. **E2Eテスト**
   - Playwrightでの自動テスト
   - 主要フローのカバー

3. **パフォーマンステスト**
   - 負荷テストの実装
   - メモリリーク検知

**期待効果**: リグレッション防止
**工数**: 4-5時間

## 実装優先順位の提案

### 短期（今週中）
1. **Option A: 疲労度計算の完成** ← 最優先推奨
   - ビジネス価値が最も高い
   - ユーザーが期待している機能
   
2. **Option B: パフォーマンス最適化（部分的）**
   - 仮想スクロールのみ先行実装

### 中期（来週）
3. **Option D: UI/UX改善**
   - エクスポート機能を優先
   
4. **Option E: テスト強化**
   - 重要な部分から段階的に

### 長期（再来週以降）
5. **Option C: 型安全性**
   - 段階的にリファクタリング

## 質問事項

1. **ビジネス優先度**
   - 疲労度計算の精度向上が最優先でよいか？
   - エクスポート機能の要望はあるか？

2. **技術的制約**
   - パフォーマンス問題は顕在化しているか？
   - 他システムとの連携予定はあるか？

3. **リソース**
   - 実装にかけられる時間は？
   - 他のメンバーの協力は得られるか？

4. **既存機能の改善要望**
   - 現在の集約・フィルター機能で不足はないか？
   - UIで使いにくい部分はないか？

## リスクと対策

### リスク
1. **疲労度計算の複雑化** → 段階的実装で対応
2. **パフォーマンス劣化** → プロファイリングで監視
3. **既存機能への影響** → Feature Flagで制御

### 対策
- 各実装前にブランチ作成
- 段階的なロールアウト
- A/Bテストでの効果測定

## 推奨する進め方

1. **まず疲労度計算（Option A）のプロトタイプ作成**
2. **ユーザーレビューを受ける**
3. **フィードバックを基に調整**
4. **本実装とテスト作成**
5. **段階的に他のOptionを実装**

---

ご意見をお聞かせください。特に：
- どのOptionを優先すべきか
- 追加で必要な機能はあるか
- 実装にかけられる時間の目安

これらの情報を基に、最適な実装計画を立案します。