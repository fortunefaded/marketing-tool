# TASK-101: 集約トグルボタンの削除 - 要件定義

## 📋 要件概要

**要件ID**: REQ-001  
**要件内容**: システムは常に集約されたデータを表示しなければならない  
**実装対象**: FatigueDashboardコンポーネントからの集約トグルボタン削除  

## 🎯 受け入れ基準

### 1. UI要件
- [ ] 「集約：ON」トグルボタンがダッシュボードから完全に削除されている
- [ ] トグルボタン削除後もレイアウトが適切に表示される
- [ ] 他のUI要素に影響を与えない
- [ ] レスポンシブデザインが維持される

### 2. 機能要件  
- [ ] データ表示は常に集約モードで動作する
- [ ] `enableAggregation`状態が常にtrueを保持する
- [ ] ユーザーが集約状態を変更できない
- [ ] 既存の疲労度分析機能が正常に動作する

### 3. 技術要件
- [ ] TypeScriptコンパイルエラーが発生しない
- [ ] 既存のテストが引き続き通過する
- [ ] 新しいテストケースが追加される
- [ ] コードレビュー基準に準拠する

## 📂 実装対象ファイル

### 主要ファイル
1. **FatigueDashboardContainer.tsx**
   - 集約状態管理の簡素化
   - `enableAggregation`の固定化
   - トグル関連のステート削除

2. **FatigueDashboardPresentation.tsx**  
   - トグルボタンUIの削除
   - レイアウト調整
   - プロップスの簡素化

### 関連ファイル
3. **FatigueDashboard.test.tsx** (存在する場合)
   - テストケースの更新
   - 新規テストケースの追加

4. **Types** (必要に応じて)
   - プロップス型定義の更新

## 🔍 現在の実装分析

### FatigueDashboardContainer.tsx (L20)
```typescript
const [enableAggregation, setEnableAggregation] = useState(true) // デフォルトで集約を有効化
```

**変更方針**: 
- `useState`を削除し、`enableAggregation`を定数`true`に変更
- `setEnableAggregation`の全ての参照を削除

### 予想される変更箇所
1. **ステート宣言**: `enableAggregation`の固定化
2. **プロップス渡し**: プレゼンテーション層への渡し方変更
3. **UI表示**: トグルボタンコンポーネントの削除
4. **イベントハンドラー**: トグル関連の関数削除

## 🧪 テスト戦略

### 1. 単体テスト
- [ ] トグルボタンが表示されないことの確認
- [ ] `enableAggregation`が常にtrueであることの確認
- [ ] 集約データが正しく表示されることの確認

### 2. 統合テスト  
- [ ] ダッシュボード全体の表示確認
- [ ] 疲労度分析機能の動作確認
- [ ] データ更新時の動作確認

### 3. スナップショットテスト
- [ ] UI変更前後のスナップショット比較
- [ ] レイアウトの一貫性確認

## 🚫 やってはいけないこと

1. **既存機能への影響**
   - 疲労度スコア計算機能を変更してはいけない
   - データ集約ロジックそのものを変更してはいけない
   - 他のダッシュボード機能に影響を与えてはいけない

2. **パフォーマンス劣化**
   - レンダリング性能を悪化させてはいけない
   - 不要な再レンダリングを発生させてはいけない

3. **アクセシビリティ**
   - キーボードナビゲーションを損なってはいけない
   - スクリーンリーダー対応を悪化させてはいけない

## 📊 成功指標

### 定量指標
- [ ] **UIテスト通過率**: 100%
- [ ] **レンダリング時間**: 現在と同等以下
- [ ] **バンドルサイズ**: 現在より小さい (トグル削除により)
- [ ] **TypeScriptエラー**: 0件

### 定性指標  
- [ ] **UI簡素化**: トグルボタン削除によるユーザビリティ向上
- [ ] **コード可読性**: 不要なステート管理の削除による改善
- [ ] **保守性**: 複雑性の削減による保守負荷軽減

## 🔄 実装フロー

### Phase 1: Red (失敗するテスト作成)
1. トグルボタンが存在しないことを確認するテスト
2. `enableAggregation`が常にtrueであることを確認するテスト
3. テスト実行 → 失敗確認

### Phase 2: Green (最小実装)
1. FatigueDashboardContainerの修正
2. FatigueDashboardPresentationの修正  
3. テスト実行 → 成功確認

### Phase 3: Refactor (品質向上)
1. コードクリーンアップ
2. 型定義の最適化
3. 不要なインポートの削除
4. 最終テスト実行

## 📝 実装メモ

### 調査が必要な点
1. FatigueDashboardPresentationの現在の実装内容
2. 集約トグルがどのUIコンポーネントで実装されているか
3. プロップスの受け渡し構造
4. 既存テストの有無と内容

### 注意事項
1. `useAdFatigueWithAggregation`フックの使用方法確認
2. 集約無効化時の処理が他箇所に依存していないか確認
3. ユーザー設定保存機能があれば削除対象に含める

---

**要件定義完了**: ✅  
**次のステップ**: テストケース作成 (tdd-testcases.md)