# Marketing Tool 要件定義書（逆生成）

## 分析概要

**分析日時**: 2025-09-06
**対象コードベース**: /Users/rakewonno/Documents/marketing-tool
**抽出要件数**: 23個の機能要件、14個の非機能要件
**信頼度**: 85% （実装カバレッジに基づく）

## システム概要

### 推定されたシステム目的
Meta広告の疲労度分析とパフォーマンス管理を行う統合マーケティングダッシュボード。広告クリエイティブの疲労度を自動分析し、CTR、Frequency、CPMなどの指標を総合的にスコアリングすることで、マーケターでなくても広告効果を測定できるツール。

### 対象ユーザー
- マーケティング担当者
- 広告運用担当者
- 経営管理者
- データアナリスト

## ユーザーストーリー

### ストーリー1: 広告パフォーマンス監視
- **である** マーケティング担当者 **として**
- **私は** Meta広告のパフォーマンスをリアルタイムで監視 **をしたい**
- **そうすることで** 広告の最適化タイミングを逃さない

**実装根拠**: 
- `MainDashboard.tsx` - メインダッシュボード実装
- `FatigueDashboardPresentation.tsx` - 疲労度表示コンポーネント
- Meta Graph API v23.0統合

### ストーリー2: 広告疲労度分析
- **である** 広告運用担当者 **として**
- **私は** クリエイティブの疲労度を自動分析 **をしたい**
- **そうすることで** 広告の入れ替えタイミングを最適化できる

**実装根拠**:
- 疲労度スコアリングアルゴリズム（0-100）
- CTR低下率、Frequency、CPM上昇率の複合分析
- 3つの疲労指標（クリエイティブ疲労、視聴者疲労、アルゴリズム疲労）

### ストーリー3: データ管理
- **である** システム管理者 **として**
- **私は** ローカルデータを効率的に管理 **をしたい**
- **そうすることで** システムのパフォーマンスを維持できる

**実装根拠**:
- `SettingsManagement.tsx` - 設定管理画面
- `DataManagement.tsx` - データ管理コンポーネント
- 3層キャッシュシステム（Convex、LocalStorage、SessionStorage）

## 機能要件（EARS記法）

### 通常要件

#### REQ-001: Meta広告データ取得
システムはMeta Graph API v23.0を使用して広告データを取得しなければならない。

**実装根拠**: 
- `MainDashboard.tsx:225-257` - API呼び出し実装
- アクセストークンによる認証
- 日付範囲指定（last_7d, last_14d, last_30d, last_90d, all, custom）

#### REQ-002: 広告疲労度計算
システムは3つの指標を用いて広告疲労度を0-100でスコアリングしなければならない。

**実装根拠**:
- CTR低下率がベースラインから25%を下回る → クリエイティブ疲労
- Frequencyが3.5を超える → 視聴者疲労
- CPM上昇率が20%を超える → アルゴリズム疲労

#### REQ-003: データキャッシュ管理
システムは30分間のデータキャッシュを提供しなければならない。

**実装根拠**:
- `localStorage.ts` - キャッシュ管理ユーティリティ
- 30分以内のデータは再取得しない
- キャッシュキーにアカウントIDと日付範囲を含む

#### REQ-004: マルチアカウント管理
システムは複数のMeta広告アカウントを管理できなければならない。

**実装根拠**:
- Convexデータベースでのアカウント管理
- アクティブアカウントの切り替え機能
- アカウント別のアクセストークン管理

### 条件付き要件

#### REQ-101: キャッシュ有効期限切れ時の処理
キャッシュが30分を超えた場合、システムは新しいデータを取得しなければならない。

**実装根拠**:
- `MainDashboard.tsx:113-117` - キャッシュ年齢チェック
- 自動的な再フェッチロジック

#### REQ-102: API制限到達時の処理
APIレート制限に達した場合、システムはエラーメッセージを表示しなければならない。

**実装根拠**:
- エラーハンドリング実装
- フォールバックとしてキャッシュデータ使用

### 状態要件

#### REQ-201: ローディング状態の表示
データ取得中、システムは適切なローディング表示を行わなければならない。

**実装根拠**:
- `isLoading`状態管理
- プログレス表示コンポーネント

#### REQ-202: エラー状態の表示
エラー発生時、システムは明確なエラーメッセージを表示しなければならない。

**実装根拠**:
- `error`状態管理
- エラー表示UI（赤色のアラートボックス）

### オプション要件

#### REQ-301: カスタム日付範囲
システムはカスタム日付範囲の選択を提供してもよい。

**実装根拠**:
- `customDateRange`状態管理
- 日付ピッカーUI実装

#### REQ-302: データエクスポート
システムはデータのJSON形式でのエクスポートを提供してもよい。

**実装根拠**:
- `DataManagement.tsx:96-115` - エクスポート機能
- Blob生成とダウンロード実装

### 制約要件

#### REQ-401: Frequency閾値
システムはFrequency 3.5を危険水準として判定しなければならない。

**実装根拠**:
- CLAUDE.md内の指標定義
- 疲労度計算アルゴリズム

#### REQ-402: CTR低下閾値
システムはCTR25%低下を危険水準として判定しなければならない。

**実装根拠**:
- CLAUDE.md内の指標定義
- ベースライン比較ロジック

## 非機能要件

### パフォーマンス

#### NFR-001: API応答時間
システムはMeta APIからのデータ取得を5秒以内に完了しなければならない。

**実装根拠**:
- 効率的なAPI呼び出し
- limit: 500設定

#### NFR-002: キャッシュ効率
システムは30分以内の再アクセスでキャッシュを使用しなければならない。

**実装根拠**:
- LocalStorageキャッシュシステム
- タイムスタンプベースの有効期限管理

### セキュリティ

#### NFR-101: アクセストークン管理
システムはアクセストークンを安全に保管しなければならない。

**実装根拠**:
- Convexデータベースでの暗号化保存
- トークンのログ出力時マスキング

#### NFR-102: CORS対応
システムはCORS設定を適切に処理しなければならない。

**実装根拠**:
- Vite設定でのプロキシ設定
- APIエンドポイントの適切な設定

### ユーザビリティ

#### NFR-201: レスポンシブデザイン
システムは様々な画面サイズに対応しなければならない。

**実装根拠**:
- Tailwind CSSのレスポンシブクラス使用
- フレックスボックスレイアウト

#### NFR-202: 日本語対応
システムは全てのUIを日本語で表示しなければならない。

**実装根拠**:
- CLAUDE.md内の言語設定
- 日本語のラベル、メッセージ実装

### 運用性

#### NFR-301: ログ出力
システムは重要な操作をコンソールログに記録しなければならない。

**実装根拠**:
- vibeloggerユーティリティ
- 構造化ログ出力

#### NFR-302: データクリーンアップ
システムは30日以上古いデータを自動削除しなければならない。

**実装根拠**:
- `localDataStore.ts` - 自動クリーンアップ
- IndexedDBのcleanup機能

## Edgeケース

### エラー処理

#### EDGE-001: Convex接続失敗
Convexデータベースに接続できない場合のフォールバック処理

**実装根拠**:
- エラーメッセージ表示
- ローカルキャッシュの使用

#### EDGE-002: Meta API認証失敗
アクセストークンが無効な場合の処理

**実装根拠**:
- エラーステート管理
- 再認証への誘導

### 境界値

#### EDGE-101: 大量データ処理
500件以上のデータ取得時のページネーション

**実装根拠**:
- API limit設定
- 仮想スクロール実装

#### EDGE-102: ストレージ容量制限
LocalStorage 5MB制限への対応

**実装根拠**:
- SessionStorageへのフォールバック
- 古いデータの自動削除

## 受け入れ基準

### 実装済み機能テスト

- [x] Meta API統合
  - [x] データ取得成功
  - [x] 日付範囲フィルタ
  - [x] キャッシュ機能
- [x] 疲労度分析
  - [x] スコア計算
  - [x] 3指標の評価
  - [x] アラート表示
- [x] データ管理
  - [x] キャッシュクリア
  - [x] エクスポート機能
  - [x] インポート機能

### 推奨追加テスト

- [ ] **パフォーマンステスト**
  - [ ] 大量データ処理
  - [ ] メモリ使用量測定
- [ ] **セキュリティテスト**
  - [ ] トークン漏洩対策
  - [ ] XSS対策確認
- [ ] **互換性テスト**
  - [ ] ブラウザ互換性
  - [ ] モバイル対応

## 推定されていない要件

### 不明確な部分

1. **ビジネス要件**
   - ROASの具体的な計算方法
   - ECForce統合の詳細仕様
   - レポート生成の頻度と形式

2. **運用要件**
   - バックアップ戦略
   - 災害復旧計画
   - SLA定義

3. **法的要件**
   - GDPR準拠
   - 個人情報保護法対応

### 推奨される次ステップ

1. **TypeScriptエラーの完全解消** - 型安全性の確保
2. **テストカバレッジの向上** - 単体テスト、統合テストの追加
3. **パフォーマンス最適化** - バンドルサイズ削減
4. **ドキュメント整備** - APIドキュメント、運用マニュアル

## 分析の制約事項

### 信頼度に影響する要因

- **TypeScriptエラー**: 多数のエラーが残存（削除ファイル参照）
- **テスト不足**: テストカバレッジが低い
- **ドキュメント不足**: コメントが最小限

### 推定の根拠

- **強い根拠**: 実装コード + CLAUDE.md仕様書
- **中程度の根拠**: 実装のみ、動作確認済み
- **弱い根拠**: 推定による補完