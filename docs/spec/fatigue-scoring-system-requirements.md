# 広告疲労度スコアリングシステム 要件定義書

## 概要

動画クリエイティブの広告疲労度を3つの指標（クリエイティブ疲労、視聴者疲労、アルゴリズム疲労）で総合的にスコアリング（0-100）し、マーケターでなくとも広告効果を直感的に測定・判断できるシステムを構築する。Meta API及びInstagram Insightsから取得したデータを基に、自動的な疲労度分析と推奨アクションを提供する。

## ユーザストーリー

### ストーリー1: 直感的な疲労度判定

- **であるマーケター として**
- **私は** 動画クリエイティブの疲労度を0-100の分かりやすいスコアで確認したい
- **そうすることで** 専門知識がなくても広告の健全性を瞬時に判断でき、適切なタイミングで対策を講じることができる

### ストーリー2: 疲労要因の特定

- **であるマーケター として**
- **私は** 疲労度の内訳（クリエイティブ・視聴者・アルゴリズム）を個別に確認したい
- **そうすることで** 問題の根本原因を特定し、最も効果的な改善策を選択できる

### ストーリー3: Instagram特有の分析

- **であるInstagram広告運用者 として**
- **私は** プロフィール訪問率やエンゲージメント率などInstagram固有のメトリクスを確認したい
- **そうすることで** プラットフォーム特性を活かした最適化判断ができる

### ストーリー4: 危険水準の早期検知

- **であるマーケティング責任者 として**
- **私は** 広告疲労が危険水準に達した際に自動的にアラートを受けたい
- **そうすることで** 広告効果の悪化を未然に防ぎ、ROASの維持・向上を図ることができる

### ストーリー5: ベースラインとの比較

- **であるマーケター として**
- **私は** 現在の広告パフォーマンスを過去のベースラインと比較して確認したい
- **そうすることで** 疲労度の進行状況を定量的に把握し、適切な判断タイミングを見極めることができる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは各動画クリエイティブの疲労度を0-100の数値スコアで算出しなければならない
- REQ-002: システムは疲労度スコアを3つの構成要素（クリエイティブ疲労・視聴者疲労・アルゴリズム疲労）に分解表示しなければならない
- REQ-003: システムはMeta APIから基本メトリクス（広告費用、インプレッション、クリック数、CTR、CPC、CPM、Frequency）を取得しなければならない
- REQ-004: システムはInstagram Insights APIから特有メトリクス（profile_views、follower_count、エンゲージメント指標）を取得しなければならない
- REQ-005: システムは疲労度スコアに基づいて健全性ステータス（健全・注意・危険）を自動判定しなければならない
- REQ-006: システムは各クリエイティブに対して具体的な改善推奨アクションを提示しなければならない

### 条件付き要件

- REQ-101: CTR低下率がベースラインから25%以上低下した場合、システムはクリエイティブ疲労スコアを悪化させなければならない
- REQ-102: Frequencyが3.5を超えた場合、システムは視聴者疲労スコアを悪化させ、危険水準として分類しなければならない
- REQ-103: CPM上昇率がベースラインから20%以上上昇しかつCTRが同時に低下している場合、システムはアルゴリズム疲労スコアを悪化させなければならない
- REQ-104: Instagram Reelsのエンゲージメント率が1.23%を下回る場合、システムは警告表示を行わなければならない
- REQ-105: 一般投稿のエンゲージメント率が0.7%を下回る場合、システムは警告表示を行わなければならない
- REQ-106: 疲労度スコアが50を下回る場合、システムはクリティカルアラートを発生させなければならない
- REQ-107: 疲労度スコアが70を下回る場合、システムは警告アラートを発生させなければならない

### 状態要件

- REQ-201: ベースラインデータが不足している状態にある場合、システムは初期ベースライン計算モードで動作しなければならない
- REQ-202: データ取得エラー状態にある場合、システムは利用可能な部分データで疲労度を算出し、信頼度情報を併記しなければならない
- REQ-203: 新規クリエイティブ（配信開始から48時間以内）の状態にある場合、システムは「分析準備中」表示を行わなければならない

### オプション要件

- REQ-301: システムは初回インプレッション比率を擬似的に推定計算してもよい
- REQ-302: システムは疲労度トレンドを時系列グラフで表示してもよい
- REQ-303: システムは競合他社の平均値との比較機能を提供してもよい
- REQ-304: システムは疲労度改善のA/Bテスト推奨機能を提供してもよい
- REQ-305: システムは疲労度予測機能（1週間先の予測値）を提供してもよい

### 制約要件

- REQ-401: システムは疲労度計算に最低7日間のデータ蓄積を必要としなければならない
- REQ-402: システムはベースライン計算期間を直近30日間に設定しなければならない
- REQ-403: システムは疲労度スコア更新頻度を最大1日1回に制限しなければならない
- REQ-404: システムはInstagram APIの制限により一部メトリクスが取得不可の場合も動作継続しなければならない

## 非機能要件

### パフォーマンス

- NFR-001: 疲労度計算処理は1クリエイティブあたり200ms以内に完了しなければならない
- NFR-002: 100クリエイティブのバッチ処理は30秒以内に完了しなければならない
- NFR-003: 疲労度スコアの精度は専門家判定との一致率80%以上を維持しなければならない

### データ品質

- NFR-101: 疲労度計算に使用する全メトリクスは取得時にデータ検証を実行しなければならない
- NFR-102: ベースライン計算の信頼性を確保するため、欠損データが30%を超える場合は計算を延期しなければならない
- NFR-103: 疲労度スコアには計算根拠となるデータ品質評価を0.0-1.0で併記しなければならない

### ユーザビリティ

- NFR-201: 疲労度スコアは色分け表示（緑：健全、黄：注意、赤：危険）で直感的に理解できなければならない
- NFR-202: 各疲労指標の説明は専門用語を避け、平易な日本語で表示しなければならない
- NFR-203: 改善推奨アクションは具体的で実行可能な内容でなければならない

### 拡張性

- NFR-301: システムは新しい疲労指標の追加に対応可能な設計でなければならない
- NFR-302: システムはプラットフォーム別（Meta、Instagram、将来的にTikTok等）の疲労度算出に対応可能でなければならない

## Edgeケース

### データ異常処理

- EDGE-001: CTRが異常に高い値（10%超）を示す場合、データエラーとして扱い疲労度計算から除外する
- EDGE-002: CPMが0または負の値の場合、該当期間のデータを無効とし前日データで補完する
- EDGE-003: Frequencyが20を超える場合、システムエラーの可能性として管理者に通知する
- EDGE-004: インプレッション数が0の日が7日連続した場合、配信停止状態として疲労度計算を一時停止する

### ベースライン算出困難ケース

- EDGE-101: 新規アカウントでベースライン期間（30日）のデータが不足する場合、業界平均値を暫定ベースラインとして使用する
- EDGE-102: 配信期間が断続的でデータ密度が低い場合、利用可能なデータのみでベースライン算出し信頼度を下げる
- EDGE-103: 大幅な予算変更（50%以上増減）があった場合、ベースライン再計算期間を延長する

### プラットフォーム固有制限

- EDGE-201: Instagram Insights APIで一部メトリクス取得に失敗した場合、Meta全体データから推定値を算出する
- EDGE-202: profile_viewsデータが取得できない場合、CTRとの相関性から擬似的に推定する
- EDGE-203: エンゲージメント詳細データが不完全な場合、利用可能な指標のみで簡易エンゲージメント率を算出する

### スケール対応

- EDGE-301: 処理対象クリエイティブ数が1000を超える場合、重要度順（広告費用上位）に処理優先順位を設定する
- EDGE-302: 同時処理要求が集中した場合、アカウント毎にキューイング処理を行い順次実行する

## 詳細仕様

### 疲労度計算アルゴリズム

#### クリエイティブ疲労スコア（0-100）
```
計算式: 100 - (CTR低下率 × 2 + unique_CTR低下率 × 1.5 + inline_link_click_CTR低下率 × 1.0)
- CTR低下率 = (ベースラインCTR - 現在CTR) / ベースラインCTR × 100
- 25%低下で50点、50%低下で0点となるように調整
```

#### 視聴者疲労スコア（0-100）
```
計算式: 100 - (Frequency影響度 × 3 + 初回インプレッション比率影響度 × 2)
- Frequency影響度 = max(0, (現在Frequency - 3.5) / 6.5 × 100)
- 初回インプレッション比率影響度 = max(0, (0.7 - 推定初回率) / 0.7 × 100)
```

#### アルゴリズム疲労スコア（0-100）
```
計算式: 100 - (CPM上昇率 × 2.5 + 配信ボリューム低下率 × 1.5)
- CPM上昇率 = (現在CPM - ベースラインCPM) / ベースラインCPM × 100
- 20%上昇で50点、40%上昇で0点となるように調整
```

#### 総合疲労度スコア
```
総合スコア = (クリエイティブ疲労 × 0.4 + 視聴者疲労 × 0.35 + アルゴリズム疲労 × 0.25)
重み付けは業界標準とユーザーフィードバックに基づく
```

### Instagram特有メトリクス仕様

#### エンゲージメント率算出
```
エンゲージメント率 = (いいね + コメント + 保存 + シェア) ÷ リーチ × 100

取得エンドポイント:
- いいね: /{media-id}/insights?metric=likes
- コメント: /{media-id}/insights?metric=comments  
- 保存: /{media-id}/insights?metric=saved
- シェア: /{media-id}/insights?metric=shares
- リーチ: /{media-id}/insights?metric=reach
```

#### プロフィール訪問率
```
プロフィール訪問率 = profile_views ÷ インプレッション × 100
取得: /{media-id}/insights?metric=profile_views
```

#### フォロー率  
```
フォロー率 = follower_count増加数 ÷ リーチ × 100
取得: /{account-id}/insights?metric=follower_count&period=day
```

## 受け入れ基準

### 機能テスト

- [ ] 疲労度スコアが0-100の範囲で正しく計算されること
- [ ] 3つの疲労指標が個別に表示されること  
- [ ] CTR25%低下でクリエイティブ疲労スコアが適切に悪化すること
- [ ] Frequency3.5超えで視聴者疲労スコアが危険レベルになること
- [ ] CPM20%上昇+CTR低下でアルゴリズム疲労スコアが悪化すること
- [ ] Instagram特有メトリクス（プロフィール訪問率、エンゲージメント率）が取得・表示されること
- [ ] 疲労度スコアに基づくステータス判定（健全・注意・危険）が正しく動作すること
- [ ] 改善推奨アクションが疲労要因に応じて適切に表示されること

### 非機能テスト

- [ ] 疲労度計算が1クリエイティブ200ms以内で完了すること
- [ ] 100クリエイティブ処理が30秒以内で完了すること
- [ ] データ検証機能が異常値を適切に検出・除外すること
- [ ] 欠損データ30%超で計算延期処理が動作すること
- [ ] 疲労度スコアの色分け表示が正しく動作すること

### 統合テスト

- [ ] Meta API連携で全基本メトリクスが取得できること
- [ ] Instagram Insights API連携で特有メトリクスが取得できること  
- [ ] ベースライン計算が30日間データで正しく実行されること
- [ ] 疲労度履歴の蓄積・管理が正常に動作すること
- [ ] エラー状態での部分データ処理が適切に動作すること

### エッジケーステスト

- [ ] 新規クリエイティブで「分析準備中」表示されること
- [ ] データ異常値（CTR10%超等）が適切に除外されること
- [ ] Instagram API制限時に代替データ処理が動作すること
- [ ] 大量クリエイティブ処理時に優先順位制御が動作すること
- [ ] ベースライン不足時に業界平均代替処理が動作すること

### ユーザビリティテスト

- [ ] マーケターが疲労度スコアを直感的に理解できること
- [ ] 疲労要因の説明が専門知識なしで理解できること
- [ ] 改善推奨アクションが具体的で実行可能であること
- [ ] 色分け表示で健全性が瞬時に判断できること
- [ ] Instagram特有指標の意味と重要性が理解できること

## 実装優先度

### Phase 1: コア疲労度計算（高優先度）
- 基本メトリクス取得とベースライン計算
- 3つの疲労指標算出アルゴリズム
- 総合スコア計算と状態判定

### Phase 2: Instagram統合（中優先度）  
- Instagram Insights API連携
- プラットフォーム固有メトリクス算出
- エンゲージメント率計算

### Phase 3: UX向上（中優先度）
- 色分け表示とアラート機能
- 改善推奨アクション生成
- トレンド表示

### Phase 4: 高度な機能（低優先度）
- 疲労度予測機能
- A/Bテスト推奨
- 競合比較機能